# AGENTS.md — правила работы кодинг-агента

## Цель
Проект развиваем итерациями. Любое изменение должно быть маленьким, проверяемым и вливаемым через PR.

## Обязательные правила
1) 1 Issue = 1 PR.
2) Каждый PR должен:
   - собираться
   - иметь тесты (если затрагивает `Ludus.Core`)
   - обновлять документацию, если меняет поведение/архитектуру
3) Нельзя смешивать “рефакторинг” и “фичу” в одном PR.
4) Любая логика симуляции/боя живёт в `src/Ludus.Core`, а Godot — только UI/визуал/интеграция.

## Обязательный паттерн: issue → ветка → PR
Для каждой задачи строго соблюдай последовательность:
1) Определи номер issue (например, `#123`).
2) Создай отдельную ветку от актуальной `main` в формате: `issue/<номер>-<slug>`.
3) Выполни изменения только в рамках этого issue.
4) Открой ровно один PR из этой ветки.
5) В PR обязательно укажи явную связь с issue по номеру:
   - в заголовке или описании: `Closes #123` (или `Fixes #123`)
   - номер issue должен быть указан в явном виде (`#123`), а не только ссылкой без номера.

Если в PR нет явной связи с issue (`Closes/Fixes #<номер>`), PR считается оформленным некорректно.

## Архитектурные принципы
- Детерминизм: симуляция должна быть воспроизводима по seed.
- Event-driven внутри ядра: важные изменения состояния оформляем как события.
- IO/сохранения через интерфейсы (адаптеры в `game/`).

## Definition of Done (DoD)
- Код отформатирован
- Добавлены/обновлены тесты
- Нет “мертвого” кода и TODO без Issue
- В PR описано: что сделано, как проверить

## Ветки/коммиты
- Ветка: `issue/<номер>-<slug>`
- Коммиты: маленькие, осмысленные
- Сообщение PR: включает ссылку на issue и чеклист “как проверить”

## Запрещено
- Коммитить секреты (`.qwen/.env`, ключи, токены)
- Менять структуру проекта без ADR в `docs/adr/`

## Создание Pull Request
При создании PR соблюдай строгую последовательность:
1) **Сначала сделай push ветки:** `git push -u origin <branch-name>`
2) **Потом создай PR:** `gh pr create ...`

**Важно:** Не используй многострочный `--body` с multiple `--body` флагами — это вызывает ошибки парсинга в CLI. Используй один `--body` с `\n` для переносов строк:

```bash
# Правильно:
gh pr create --title "Title" --body "Line 1\nLine 2\nLine 3"

# Не правильно (вызывает ошибки):
gh pr create --title "Title" --body "Line 1" --body "Line 2"
```
