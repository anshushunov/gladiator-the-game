# Gladiator Ludus Simulator

Симулятор/песочница про управление лудусом: найм гладиаторов, тренировки, экономика и бои.

## Tech
- Godot 4.x (.NET) + C#
- .NET SDK 8+
- Тесты: xUnit (ядро симуляции отдельно от движка)

## Репозиторий
- `game/` — Godot проект (UI/сцены/визуализация)
- `src/Ludus.Core/` — чистое доменное ядро (симуляция, баланс, бой)
- `src/Ludus.Tests/` — тесты на ядро
- `docs/` — дизайн, ADR, заметки по балансу

## Быстрый старт

### Запуск игры в Godot
1) Установить Godot 4.x .NET и .NET SDK 8+
2) Открыть `game/project.godot` в редакторе Godot
3) Дождаться автоматической сборки C# проекта (внизу статус-бар)
4) Нажать кнопку Play (F5) для запуска

### Запуск тестов ядра
- `dotnet test` — запустить все тесты xUnit в `src/Ludus.Tests/`

## MVP-петля (первая цель)
1) Нанять 3 гладиаторов
2) Назначить тренировки на неделю
3) Провести бой (авторезолв)
4) Получить деньги/травмы/прогресс
5) Повторить

### Поведение боя в UI
- После симуляции боя результат применяется к `LudusState`.
- Победитель сохраняет остаток HP, проигравший остаётся в ростере с `HP = 0`.
- Игра остаётся в основном экране: можно сразу продолжать найм, дни и следующие бои.

## Post-MVP Roadmap

### Выполнено
- [x] Issue-0: Post-MVP roadmap in README
- [x] Issue-A: UI Foundation v2
- [x] Issue-B: Asset Pack v1 Integration
- [x] Issue-C: Training System v1
- [x] Issue-D: Injuries & Recovery v1
- [x] Issue-E: Morale/Fatigue v1

---

### [x] Issue-F: Contracts & Wages v1
- Goal:
  - ввести контракты и регулярные выплаты/риски ухода.
- Changes:
  - контрактные условия, продление, последствия просрочки выплат.
- How to verify:
  1) денежные расчеты детерминированы;
  2) тесты покрывают просрочку, продление и уход;
  3) экономика не нарушает базовые инварианты `LudusState`.

### [x] Issue-G: Daily Events v1
- Goal:
  - добавить события дня с выбором игрока и последствиями.
- Changes:
  - event-driven модель дневных событий в Core и отображение в UI;
  - `AdvanceDay` создает pending-событие, а `ResolveDailyEvent` применяет выбор игрока;
  - в UI добавлена панель дневного события с двумя вариантами.
- How to verify:
  1) события воспроизводимы по seed;
  2) выбор игрока дает корректные и тестируемые последствия;
  3) без выбора по событию переход к следующему дню невозможен.

### [ ] Issue-H: Tournaments v1
- Goal:
  - добавить турнирную систему: серии боёв с сеткой, рейтингом и наградами.
- Changes:
  - модель турнира (сетка, раунды, призовой фонд) в `src/Ludus.Core` + тесты;
  - UI турнирной сетки и результатов в `game/`.
- How to verify:
  1) турнир из N участников корректно формирует сетку и проводит все раунды;
  2) результаты детерминированы по seed;
  3) призовые начисляются победителям, травмы/мораль применяются после каждого боя;
  4) тесты покрывают edge-кейсы (нечётное число участников, отказ/травма до боя).

### [ ] Issue-I: Equipment v1
- Goal:
  - добавить экипировку (оружие и броня) с влиянием на параметры боя.
- Changes:
  - типы экипировки, слоты, модификаторы к атаке/защите в `src/Ludus.Core` + тесты;
  - покупка/назначение экипировки через UI в `game/`.
- How to verify:
  1) экипировка корректно модифицирует боевые расчёты в `CombatResolver`;
  2) тесты покрывают комбинации экипировки и граничные значения;
  3) экономика покупки/продажи не нарушает инварианты `LudusState`;
  4) UI отображает экипировку в карточке гладиатора.

### [ ] Issue-J: Save/Load
- Goal:
  - реализовать сохранение и загрузку состояния игры.
- Changes:
  - сериализация/десериализация `LudusState` (JSON) в `src/Ludus.Core` + тесты;
  - UI кнопок Save/Load и выбор слота сохранения в `game/`.
- How to verify:
  1) сохранённое состояние полностью восстанавливается (все поля `LudusState`);
  2) детерминизм сохраняется: загрузка + те же действия = тот же результат;
  3) тесты покрывают round-trip сериализацию, миграцию формата, повреждённые файлы;
  4) UI корректно обрабатывает отсутствие/повреждение файла сохранения.

## Visual Direction v1
- Mood:
  - gritty arena management, "грязный" римский менеджмент, а не стерильный UI.
- UI priorities:
  - четкие панели: ростер, экономика, бой, события;
  - контрастные состояния (раны, усталость, победа/поражение);
  - читаемость важнее декоративной плотности.
- First assets:
  - иконки `STR/AGI/STA`, статусы `Injured/Fit/Tired`;
  - 1-2 фоновых изображения арены;
  - базовые карточки гладиатора и простые аудио-плейсхолдеры.

## Mechanics Direction v1 (Ludus Management)
- Core loop after MVP:
  1) найм/состав;
  2) план тренировок;
  3) дневной тик (экономика/восстановление/события);
  4) бой и последствия;
  5) корректировка состава и планов.
- Pillars:
  - тренировки;
  - травмы и восстановление;
  - мораль/усталость;
  - контракты и выплаты;
  - события дня.
- Core rule:
  - вся симуляция и бизнес-правила в `src/Ludus.Core`;
  - Godot-слой (`game/`) отвечает только за UI/визуал/интеграцию.

## Execution Policy
- `1 Issue = 1 PR` без смешения feature и refactor.
- Перед реализацией любой фичи обязательно пройти flow:
  1) выбрать фичу из раздела `Post-MVP Roadmap`;
  2) подготовить отдельный план по выбранной фиче (scope, AC, test cases, touched areas);
  3) получить явный апрув плана;
  4) только после апрува начинать реализацию в отдельной issue-ветке.
- Для каждого issue:
  0) если числового GitHub issue ещё нет, сначала создать issue в GitHub и зафиксировать его номер `#<number>`;
  1) ветка `issue/<number>-<slug>` от актуальной `main`;
  2) изменения только в рамках issue;
  3) PR с явной связью `Fixes #<number>` или `Closes #<number>`;
  4) тесты обязательны для изменений в `src/Ludus.Core`;
  5) при изменении поведения/архитектуры обновляется документация;
  6) после merge соответствующего PR выполненный issue обязательно помечается в roadmap как сделанный (`[x]`).
